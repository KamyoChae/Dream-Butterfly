"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var ModelControl=function(){function i(e,t){_classCallCheck(this,i),this.dom=document.querySelector(t),this.num=e,this.secTimer=null,this.scoreTimer=null,this.pupl=document.querySelector(".pupl"),this.numDom=document.querySelector(".score .num"),this.u=0,this.strU="",this.seconds=0,this.timeSec="",this.score=0,this.wantClickPupl=!1,this.liHeight="",this.animateDown="",this.clientWidth=document.body.clientWidth,this.clientHeight=document.body.clientHeight,this.dowFlag=!0,this.live=3,this.speed=0,this.returnDom=document.querySelector(".return"),this.markLeft=0}return _createClass(i,[{key:"run",value:function(){this.createInterval(this.num,this.dom),this.pauseClick()}},{key:"startInit",value:function(){var e=this;(new oAudio).playGame(),void 0,this.live=3,Array.from(document.querySelectorAll(".live")).forEach(function(e){e.setAttribute("class","live")}),this.numDom.innerHTML='0 <div class="seconds">0.00 秒</div>',clearInterval(this.secTimer),clearInterval(this.scoreTimer);var t=document.querySelector(".obstacle");t.innerHTML="";var i=document.createElement("ul");i.setAttribute("class","ob-list"),t.insertBefore(i,t.firstChild);for(var n=0;n<10;n++){new Renderli(2,".ob-list").run()}this.liHeight=document.querySelector(".ob-list li").offsetHeight,this.speed=0,this.butfferMove(),this.markLeft=0,document.querySelector(".yes").addEventListener("click",function(){void 0,(new oAudio).indexGame(),(new InfoStart).showWindow("index"),e.returnDom.style.zIndex="-999"}),document.querySelector(".no").addEventListener("click",function(){(void 0,0<=e.live)&&(e.returnDom.style.zIndex="-999",e.pupl.classList.add("play"),e.wantClickPupl=!0,e.dowFlag=!0,0!=e.score&&(void 0,e.computedTime()),e.pullDown())})}},{key:"createInterval",value:function(e,t){var i=this,n=e;clearInterval(s),t.innerHTML="<span>".concat(n,"</span>"),t.classList.add("show");var o=this,s=setInterval(function(){--n?t.innerHTML="<span>".concat(n,"</span>"):(i.pullDown(),t.classList.remove("show"),i.pupl.classList.add("play"),i.wantClickPupl=!0,clearInterval(s),o.computedTime())},1e3)}},{key:"computedTime",value:function(){var e=this;clearInterval(this.secTimer),clearInterval(this.scoreTimer);var t=this.u,i=this.strU,n=this.seconds,o=this.timeSec,s=this.score,l=this.numDom,r=setInterval(function(){s+=Math.ceil(5*Math.random()),e.score=s},100),c=setInterval(function(){++t<10?i="0"+t:100<=(i=t)&&(t=1,n++),o=n+"."+i+" 秒",l.innerHTML="".concat(s,'\n            <div class="seconds">').concat(o,"</div>"),e.u=t,e.strU=i,e.seconds=n,e.timeSec=o},10);this.secTimer=c,this.scoreTimer=r}},{key:"cancleTimer",value:function(){clearInterval(this.scoreTimer),clearInterval(this.secTimer),window.cancelAnimationFrame(this.animateDown),this.butflying("removefly")}},{key:"pauseClick",value:function(){var i=this,n=this;this.pupl.addEventListener("click",function(e){void 0;var t=n.pupl.classList.contains("play");i.wantClickPupl?t?(void 0,void 0,n.cancleTimer(),i.markLeft=document.querySelector(".footer").offsetLeft,n.pupl.classList.remove("play")):(n.computedTime(),n.pupl.classList.add("play"),void 0,i.pullDown("new")):void 0})}},{key:"butflying",value:function(e){var t=document.querySelector(".butterfly span");"addfly"==e&&t.classList.add("fly"),"removefly"==e&&t.classList.remove("fly")}},{key:"butfferMove",value:function(){var n=this;window.addEventListener("deviceorientation",function(e){var t=document.querySelector(".direction"),i=Math.floor(e.gamma);n.speed=i<-0?(t.innerHTML="往左"+"".concat(i),-3):0<i?(t.innerHTML="往右"+"".concat(i),3):(t.innerHTML="水平"+"".concat(i),0)}),window.addEventListener("keydown",function(e){39==e.keyCode?n.speed=2:37==e.keyCode&&(n.speed=-2)})}},{key:"pullDown",value:function(e){var s=this;this.butflying("addfly"),cancelAnimationFrame(this.animateDown);var l=this,r=document.querySelector(".ob-list"),c=document.querySelector(".footer"),t=this.markLeft,a=this.clientWidth/20,u=a;"new"===e&&(u=t);!function e(){if(s.dowFlag){if(r){var t=r.offsetTop,i=t+4;if(r.style.top=i+"px",(u+=l.speed)<a?u=a:u>s.clientWidth-c.offsetWidth-a&&(u=s.clientWidth-c.offsetWidth-a),c.style.left=u+"px",t>=l.liHeight){var n=r.childNodes.length,o=r.childNodes[n-1];r.removeChild(o),r.style.top="0px",new Renderli(2,".ob-list").run()}}s.checkBackIndex(),s.checked(),s.animateDown=window.requestAnimationFrame(e)}else s.cancleTimer()}()}},{key:"checkBackIndex",value:function(){999==this.returnDom.style.zIndex&&(this.dowFlag=!1,this.pupl.classList.remove("play"),this.wantClickPupl=!1)}},{key:"collision",value:function(e,t){var i=document.querySelector(".footer"),n={},o={};if(n.x=i.offsetLeft,n.y=i.offsetTop,n.height=i.offsetHeight,n.width=i.offsetHeight,o.x=e.offsetLeft,o.y=e.offsetTop,o.width=e.offsetHeight,o.height=e.offsetHeight,n.x<o.x+o.width&&n.x+n.width>o.x&&n.y<o.y+o.height&&n.height+n.y>o.y){e.style.display="none";var s=this.live;if(0<this.live)void 0,(new oAudio).hitGame(),Array.from(document.querySelectorAll(".live"))[s-1].classList.add("livelose"),this.live--;else(new oAudio).hitGame(),this.dowFlag=!1,void 0,this.wantClickPupl=!1,(new InfoStart).showWindow("error"),(new ErrorCheck).run(),document.querySelector(".start").style.zIndex="999"}}},{key:"checked",value:function(){var t=this,e=Array.from(document.querySelectorAll(".stone")),i=[];e.forEach(function(e){""!==e.style.backgroundImage&&i.push(e)}),i.forEach(function(e){t.collision(e)})}}]),i}();